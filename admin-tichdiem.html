<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aurora Spa - Danh s√°ch t√≠ch ƒëi·ªÉm kh√°ch h√†ng</title>
    <style>
  /* ===== RESET + THEME ===== */
  *{box-sizing:border-box;font-family:"Segoe UI",sans-serif;margin:0;padding:0;}
  html,body{height:100%;}
  body{display:flex;background:#f6f7f6;color:#222;}

  :root{
    --green:#2e4d40;
    --green-700:#4b705a;
    --panel:#fff;
    --border:#e0e0e0;
  }

  /* ===== SIDEBAR (cƒÉn tr√°i y nh∆∞ l·ªãch h·∫πn) ===== */
  .sidebar{
    width:220px;
    background:var(--green);
    color:#fff;
    padding:20px 10px;
  }
  .sidebar h2{
    text-align:center;
    font-size:20px;
    margin-bottom:30px;
  }
  .sidebar ul{list-style:none;}
  .sidebar li{
    display:flex;
    align-items:center;
    padding:10px 15px;
    margin:5px 0;
    border-radius:8px;
    cursor:pointer;
  }
  .sidebar li:hover,
  .sidebar li.active{background:var(--green-700);}
  .sidebar li span{margin-left:10px;}

  /* ===== MAIN ===== */
  .main{flex:1;padding:30px;}

  /* ===== HEADER (gi·ªØ nguy√™n cƒÉn tr√°i nh∆∞ g·ªëc) ===== */
  .header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px;
  }
  .main h1{
    font-size:36px;
    font-weight:700;
    color:#2e4d40;
    text-align:left;
  }

  .top-right{display:flex;align-items:center;gap:10px;}
  .top-btn{
    background:#fff;border-radius:8px;padding:8px;cursor:pointer;
    position:relative;display:flex;align-items:center;justify-content:center;
    width:40px;height:40px;border:1px solid #ccc;
  }
  .top-btn:hover{background:#e0e0e0;}
  .icon-btn{width:24px;height:24px;fill:white;stroke:black;stroke-width:1;}
  .dot{position:absolute;width:6px;height:6px;background:#ffc107;border-radius:50%;top:5px;right:5px;}

  /* ===== THANH L·ªåC & T√åM KI·∫æM ===== */
  .filter-bar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    margin-bottom:20px;
  }
  .filter-left{display:flex;gap:10px;}
  .add-btn{
    background:var(--green);
    color:#fff;
    border:none;
    border-radius:6px;
    padding:10px 14px;
    cursor:pointer;
  }
  .add-btn:hover{background:#446b59;}
  #searchInput{
    padding:10px;
    border:1px solid #ccc;
    border-radius:6px;
    outline:none;
    width:220px;
  }

  /* ===== TABLE (cƒÉn gi·ªØa n·ªôi dung) ===== */
  table{
    width:100%;
    border-collapse:collapse;
    background:#fff;
    border-radius:10px;
    overflow:hidden;
  }
  th,td{
    padding:12px 15px;
    text-align:center;
    vertical-align:middle;
  }
  th{
    background:#f1f1f1;
    font-weight:600;
  }
  tr:nth-child(even){background:#f9f9f9;}
  tr:hover{background:#fff8e1;} /* v√†ng nh·∫°t nh·∫π khi hover */
  .actions button{
    border:none;
    background:none;
    cursor:pointer;
    font-size:16px;
    margin:0 5px;
  }

  /* ===== PAGINATION ===== */
  .pagination{text-align:center;margin-top:15px;}
  .pagination button{
    margin:0 5px;
    padding:6px 10px;
    border:1px solid #ccc;
    background:#fff;
    border-radius:4px;
    cursor:pointer;
  }
  .pagination button.active{
    background:var(--green);
    color:#fff;
    border:none;
  }

  /* ===== MODALS (cƒÉn gi·ªØa n·ªôi dung modal) ===== */
  .modal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.4);
    justify-content:center;
    align-items:center;
    z-index:999;
  }
  .modal-content{
    background:#dbe7e3;
    padding:25px 30px;
    border-radius:10px;
    min-width:520px;
    text-align:center;
  }
  .modal h2{
    text-align:center;
    margin-bottom:20px;
    border-bottom:1px solid #888;
    padding-bottom:10px;
  }
  .modal label{
    display:block;
    font-weight:600;
    margin-top:10px;
    text-align:left;
  }
  .modal input{
    width:100%;
    padding:8px;
    border:1px solid #aaa;
    border-radius:5px;
    margin-top:5px;
    text-align:center;
  }
  .modal .buttons{
    display:flex;
    justify-content:center;
    gap:15px;
    margin-top:20px;
  }
  .modal .buttons button{
    padding:8px 20px;
    border:none;
    border-radius:5px;
    color:#fff;
    background:var(--green);
    cursor:pointer;
  }
  .modal .buttons button.cancel{background:#888;}
  .modal .buttons button:hover{opacity:.9;}

  /* ===== B·∫¢NG L·ªäCH S·ª¨ ===== */
  .history-table{
    width:100%;
    border-collapse:collapse;
    background:#fff;
    border-radius:8px;
    overflow:hidden;
    margin-top:10px;
  }
  .history-table th,.history-table td{
    padding:10px 12px;
    border-bottom:1px solid #eee;
    text-align:center;
  }
  .history-table th{background:#f6f6f6;}
  .pill{
    display:inline-block;
    padding:3px 10px;
    border-radius:999px;
    border:1px solid #ddd;
    font-size:13px;
    background:#fff;
  }
  /* === Thanh thao t√°c h√†ng lo·∫°t === */
  .bulk-bar{display:none;align-items:center;gap:10px;margin-bottom:15px;padding:10px;border:1px dashed #ccc;border-radius:8px;background:#fafafa;}
  .bulk-bar.show{display:flex;}
  .bulk-bar .pill{padding:8px 12px;border-radius:6px;border:1px solid #ccc;background:#fff;cursor:pointer;}
  .bulk-bar .pill:hover{background:#ececec;}
  .bulk-bar .danger{background:#b53d3d;color:#fff;border:none;}
  .bulk-bar .danger:hover{opacity:0.9;}
</style>


</head>
<body>

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h2>Aurora Spa</h2>
    <ul>
      <li><span>Kh√°ch h√†ng</span></li>
      <li><span>D·ªãch v·ª•</span></li>
      <li><span>Blog</span></li>
      <li><span>L·ªãch h·∫πn</span></li>
      <li><span>FAQ</span></li>
      <li class="active"><span>T√≠ch ƒëi·ªÉm</span></li>
      <li><span>C√†i ƒë·∫∑t</span></li>
    </ul>
  </div>

  <!-- MAIN -->
  <div class="main">
    <!-- HEADER v·ªõi SVG icons gi·ªëng file l·ªãch h·∫πn -->
    <div class="header">
      <h1>DANH S√ÅCH T√çCH ƒêI·ªÇM KH√ÅCH H√ÄNG</h1>
      <div class="top-right">
        <button class="top-btn" title="Th√¥ng b√°o">
          <svg class="icon-btn" viewBox="0 0 24 24">
            <path d="M6 8a6 6 0 0 1 12 0v5l2 2H4l2-2V8"/>
            <path d="M9 19a3 3 0 0 0 6 0"/>
          </svg>
          <span class="dot"></span>
        </button>
        <button class="top-btn" title="Tin nh·∫Øn">
          <svg class="icon-btn" viewBox="0 0 24 24">
            <path d="M21 15a4 4 0 0 1-4 4H8l-5 4V6a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/>
          </svg>
        </button>
        <button class="top-btn" title="T√†i kho·∫£n">
          <svg class="icon-btn" viewBox="0 0 24 24">
            <circle cx="12" cy="8" r="4"/>
            <path d="M20 20a8 8 0 1 0-16 0"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- THANH T√åM KI·∫æM + N√öT TH√äM -->
    <div class="filter-bar">
      <div class="filter-left">
        <button class="add-btn" onclick="openModal('addModal')">+ Th√™m kh√°ch h√†ng</button>
      </div>
      <input id="searchInput" type="text" placeholder="T√¨m theo t√™n, SƒêT, M√£ KH" oninput="filterTable()"/>
    </div>

    <!-- B·∫¢NG CH√çNH -->
    <table id="pointTable">
      <thead>
        <tr>
          <th><input type="checkbox" id="selectAll"></th>
          <th>M√£ KH</th>
          <th>T√™n kh√°ch h√†ng</th>
          <th>ƒêi·ªÉm hi·ªán t·∫°i</th>
          <th>S·ªë GD ƒëi·ªÉm</th>
          <th>C·∫≠p nh·∫≠t g·∫ßn nh·∫•t</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody><!-- render b·∫±ng JS --></tbody>
    </table>

    <!-- PH√ÇN TRANG 2 TRANG -->
    <div class="pagination">
      <button onclick="prevPage()">‚Äπ</button>
      <button id="pageNum" class="active">1</button>
      <button onclick="nextPage()">‚Ä∫</button>
    </div>
  </div>

  <!-- ============ MODALS ============ -->
  <!-- TH√äM KH√ÅCH H√ÄNG -->
  <div id="addModal" class="modal">
    <div class="modal-content">
      <h2>Th√™m kh√°ch h√†ng</h2>
      <label>T√™n kh√°ch h√†ng *</label>
      <input id="addName" placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A"/>
      <label>S·ªë ƒëi·ªán tho·∫°i *</label>
      <input id="addPhone" placeholder="V√≠ d·ª•: 0912345678"/>
      <label>Email</label>
      <input id="addEmail" placeholder="V√≠ d·ª•: a@gmail.com"/>
      <div class="buttons">
        <button onclick="addCustomer()">Th√™m</button>
        <button class="cancel" onclick="closeModal('addModal')">H·ªßy</button>
      </div>
    </div>
  </div>

  <!-- THANH THAO T√ÅC H√ÄNG LO·∫†T -->
<div id="bulkBar" class="bulk-bar">
  <div id="bulkCount">0 m·ª•c ƒë√£ ch·ªçn</div>
  <button class="pill" onclick="openBulkAdjust('plus')">+ C·ªông ƒëi·ªÉm</button>
  <button class="pill" onclick="openBulkAdjust('minus')">‚Äì Tr·ª´ ƒëi·ªÉm</button>
  <button class="pill danger" onclick="openBulkDelete()">üóëÔ∏è X√≥a</button>
</div>

  <!-- C·ªòNG / TR·ª™ ƒêI·ªÇM -->
  <div id="adjustModal" class="modal">
    <div class="modal-content">
      <h2 id="adjustTitle">C·ªông ƒëi·ªÉm</h2>
      <label>S·ªë ƒëi·ªÉm</label>
      <input id="adjustValue" type="number" />
      <label>L√Ω do</label>
      <input id="adjustReason" placeholder="V√≠ d·ª•: Mua h√†ng / ƒêi·ªÅu ch·ªânh"/>
      <div class="buttons">
        <button onclick="confirmAdjust()">X√°c nh·∫≠n</button>
        <button class="cancel" onclick="closeModal('adjustModal')">H·ªßy</button>
      </div>
    </div>
  </div>

  <!-- X√ìA KH√ÅCH H√ÄNG -->
  <div id="deleteModal" class="modal">
    <div class="modal-content" style="text-align:center">
      <h2>X√≥a kh√°ch h√†ng</h2>
      <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√°ch h√†ng n√†y kh√¥ng?<br/>H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.</p>
      <div class="buttons">
        <button onclick="confirmDelete()">X√°c nh·∫≠n</button>
        <button class="cancel" onclick="closeModal('deleteModal')">H·ªßy</button>
      </div>
    </div>
  </div>

  <!-- L·ªäCH S·ª¨ T√çCH ƒêI·ªÇM -->
  <div id="historyModal" class="modal">
    <div class="modal-content">
      <h2>L·ªãch s·ª≠ t√≠ch ƒëi·ªÉm</h2>
      <div style="margin-bottom:10px">
        <span class="pill" id="historyHeader">M√£ KH: - ‚Ä¢ T√™n: -</span>
      </div>
      <table class="history-table" id="historyTable">
        <thead>
          <tr>
            <th>Ng√†y</th>
            <th>Thay ƒë·ªïi ƒëi·ªÉm</th>
            <th>L√Ω do</th>
            <th style="width:70px;">X√≥a</th>
          </tr>
        </thead>
        <tbody><!-- render b·∫±ng JS --></tbody>
      </table>
      <div class="buttons">
        <button class="cancel" onclick="closeModal('historyModal')">ƒê√≥ng</button>
      </div>
    </div>
  </div>

<script>
  /* ======= H√ÄM L·∫§Y TH·ªúI GIAN CH√çNH X√ÅC (C√ì GI·ªú:PH√öT:GI√ÇY) ======= */
  function getNow() {
    const now = new Date();
    const y = now.getFullYear();
    const m = String(now.getMonth() + 1).padStart(2, "0");
    const d = String(now.getDate()).padStart(2, "0");
    const hh = String(now.getHours()).padStart(2, "0");
    const mm = String(now.getMinutes()).padStart(2, "0");
    const ss = String(now.getSeconds()).padStart(2, "0");
    return `${y}-${m}-${d} ${hh}:${mm}:${ss}`;
  }

  let customers = [
    {id:"KH001", name:"Nguy·ªÖn VƒÉn A", phone:"0905123456", email:"a@gmail.com", points:120, transactions:3, updated:"2025-10-20 15:20:41"},
    {id:"KH002", name:"Tr·∫ßn Th·ªã B", phone:"0906789123", email:"b@gmail.com", points:90, transactions:2, updated:"2025-10-19 10:10:52"},
    {id:"KH003", name:"Ph·∫°m Qu·ªëc C", phone:"0987654321", email:"c@gmail.com", points:300, transactions:6, updated:"2025-10-18 08:42:32"},
    {id:"KH004", name:"L√™ M·ªπ D", phone:"0911223344", email:"d@gmail.com", points:150, transactions:4, updated:"2025-10-21 17:05:14"},
    {id:"KH005", name:"V≈© Thanh E", phone:"0909000999", email:"e@gmail.com", points:60, transactions:1, updated:"2025-10-17 09:31:59"},
  ];

  let histories = {
    "KH001":[{date:"2025-10-18 09:00:02", delta:+50, reason:"Mua h√†ng"}, {date:"2025-10-19 11:00:44", delta:+70, reason:"∆Øu ƒë√£i 20/10"}],
    "KH002":[{date:"2025-10-17 14:30:19", delta:+40, reason:"Mua h√†ng"}, {date:"2025-10-19 09:50:48", delta:+50, reason:"T√≠ch l≈©y"}],
    "KH003":[{date:"2025-10-15 13:20:11", delta:+120, reason:"Combo chƒÉm s√≥c"}, {date:"2025-10-16 16:10:59", delta:+180, reason:"Voucher"}],
    "KH004":[{date:"2025-10-19 10:30:05", delta:+150, reason:"Mua g√≥i cao c·∫•p"}],
    "KH005":[{date:"2025-10-16 15:00:33", delta:+60, reason:"Mua h√†ng"}],
  };

  let currentPage = 1;
  const perPage = Math.ceil(customers.length / 2);
  let selected = new Set();
  let currentAdjust = {id:null, type:null};
  let deleteId = null;
  let currentHistoryId = null;

  /* === H√†m ƒë·ªìng b·ªô s·ªë GD ƒëi·ªÉm v·ªõi l·ªãch s·ª≠ === */
  function syncTransactions(id=null){
    if(id){
      const c = customers.find(x => x.id === id);
      if(c) c.transactions = (histories[id]||[]).length;
    }else{
      for(const c of customers){
        const list = histories[c.id] || [];
        c.transactions = list.length;
      }
    }
  }

  function renderTable() {
    const tbody = document.querySelector("#pointTable tbody");
    tbody.innerHTML = "";
    const start = (currentPage - 1) * perPage;
    const pageData = customers.slice(start, start + perPage);

    pageData.forEach(c => {
      const tr = document.createElement("tr");
      tr.dataset.id = c.id;
      tr.innerHTML = `
        <td><input type="checkbox" class="rowCheck" data-id="${c.id}" ${selected.has(c.id)?'checked':''}></td>
        <td>${c.id}</td>
        <td>${c.name}</td>
        <td>${c.points}</td>
        <td>${c.transactions}</td>
        <td>${c.updated}</td>
        <td class="actions">
          <button title="C·ªông ƒëi·ªÉm" onclick="event.stopPropagation(); openAdjust('${c.id}','plus')">‚ûï</button>
          <button title="Tr·ª´ ƒëi·ªÉm"  onclick="event.stopPropagation(); openAdjust('${c.id}','minus')">‚ûñ</button>
          <button title="X√≥a"        onclick="event.stopPropagation(); openDelete('${c.id}')">üóëÔ∏è</button>
        </td>`;
      tr.addEventListener("click", () => openHistory(c.id));
      tbody.appendChild(tr);
    });
    document.getElementById("pageNum").textContent = currentPage;
    filterTable();
  }

  function nextPage(){ const max=Math.ceil(customers.length/perPage); if(currentPage<max){currentPage++;renderTable();} }
  function prevPage(){ if(currentPage>1){currentPage--;renderTable();} }

  function filterTable(){
    const kw=document.getElementById("searchInput").value.toLowerCase();
    document.querySelectorAll("#pointTable tbody tr").forEach(row=>{
      row.style.display=row.innerText.toLowerCase().includes(kw)?"":"none";
    });
  }

  function openModal(id){document.getElementById(id).style.display="flex";}
  function closeModal(id){document.getElementById(id).style.display="none";}

  function addCustomer(){
    const name=document.getElementById("addName").value.trim();
    const phone=document.getElementById("addPhone").value.trim();
    const email=document.getElementById("addEmail").value.trim();
    if(!name||!phone){alert("Vui l√≤ng nh·∫≠p t√™n & SƒêT!");return;}
    if(customers.some(c=>c.phone===phone)){alert("SƒêT ƒë√£ t·ªìn t·∫°i!");return;}
    const id="KH"+String(customers.length+1).padStart(3,"0");
    const now=getNow();
    customers.push({id,name,phone,email,points:0,transactions:0,updated:now});
    histories[id]=[];
    closeModal("addModal");
    renderTable();
  }

  function openAdjust(id,type){
    currentAdjust={id,type};
    document.getElementById("adjustTitle").textContent=(type==="plus"?"C·ªông":"Tr·ª´")+" ƒëi·ªÉm";
    document.getElementById("adjustValue").value="";
    document.getElementById("adjustReason").value="";
    openModal("adjustModal");
  }

  function confirmAdjust(){
    const val=parseInt(document.getElementById("adjustValue").value)||0;
    const reason=document.getElementById("adjustReason").value.trim()||"ƒêi·ªÅu ch·ªânh";
    const c=customers.find(x=>x.id===currentAdjust.id);
    if(!c)return;
    const delta=currentAdjust.type==="plus"?val:-val;
    c.points+=delta; if(c.points<0)c.points=0;
    const now=getNow(); c.updated=now;
    histories[c.id].push({date:now,delta,reason});
    syncTransactions(c.id); // üëà ƒë·ªìng b·ªô l·∫°i s·ªë GD ƒëi·ªÉm
    closeModal("adjustModal");
    renderTable();
  }

  function openDelete(id){deleteId=id;openModal("deleteModal");}
  function confirmDelete(){
    customers=customers.filter(c=>c.id!==deleteId);
    delete histories[deleteId];
    closeModal("deleteModal");
    if(currentPage>Math.ceil(customers.length/perPage))currentPage--;
    renderTable();
  }

  function openHistory(id){
    currentHistoryId=id;
    const c=customers.find(x=>x.id===id);
    document.getElementById("historyHeader").textContent=`M√£ KH: ${c.id} ‚Ä¢ T√™n: ${c.name}`;
    renderHistoryTable(id);
    openModal("historyModal");
  }

  function renderHistoryTable(id){
    const tbody=document.querySelector("#historyTable tbody");
    tbody.innerHTML="";
    (histories[id]||[]).slice().reverse().forEach((h,idx)=>{
      const tr=document.createElement("tr");
      const sign=h.delta>=0?"+":"";
      tr.innerHTML=`
        <td>${h.date}</td>
        <td>${sign}${h.delta}</td>
        <td>${h.reason}</td>
        <td><button onclick="deleteHistoryRow('${id}',${histories[id].length-1-idx})">üóëÔ∏è</button></td>`;
      tbody.appendChild(tr);
    });
  }

  function deleteHistoryRow(id,i){
    histories[id].splice(i,1);
    const c = customers.find(x => x.id === id);
    if(c) syncTransactions(id); // üëà c·∫≠p nh·∫≠t l·∫°i s·ªë GD khi x√≥a d√≤ng
    renderHistoryTable(id);
    renderTable();
  }

  // --- Khi load l·∫ßn ƒë·∫ßu: ƒë·ªìng b·ªô to√†n b·ªô ---
  syncTransactions();
  renderTable();
  attachSelectEvents();
  updateBulkBar();

   function attachSelectEvents(){
      document.querySelectorAll(".rowCheck").forEach(cb=>{
        cb.onchange=e=>{
          const id=e.target.dataset.id;
          if(e.target.checked) selected.add(id); else selected.delete(id);
          updateBulkBar();
        };
      });
      const selectAll=document.getElementById("selectAll");
      if(selectAll){
        selectAll.onchange=e=>{
          const all=document.querySelectorAll(".rowCheck");
          all.forEach(cb=>{
            cb.checked=e.target.checked;
            if(e.target.checked) selected.add(cb.dataset.id); else selected.delete(cb.dataset.id);
          });
          updateBulkBar();
        };
      }
   }
</script>



</body>
</html>
